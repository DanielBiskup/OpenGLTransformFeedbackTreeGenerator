\chapter{Implementierung}
Dieses Kapitel behandelt das diesem Dokument beiliegende Programm.
Zunächst wird Überblick darüber gegeben, wie das Programm zu bedienen ist. Anschließend wird auf die verwendeten Libraries, und den Aufbau des Programmes eingegangen. Zuletzt wird ausgeführt wie das Programm auf den Plattformen Windows und Linux kompiliert werden kann.

\section{Bedienung des Programmes}
\begin{figure} %[hbtp]
	\centering
	\includegraphics{images/applicationScreenShot.png}
	\caption{Geometrie}
	\label{IABB1}
\end{figure}

Nach dem Start des Programmes ist in der Mitte des Fensters ein sich drehender Baum zu sehen. In der linken oberen Ecke befindet sich ein Fenster mit der mit dem Titel "'TweakBar"' welches im Folgenden als Tweak Bar bezeichnet wird (siehe Abbilding \ref{IABB1}).

Die Tweak Bar enthält drei Gruppen von Einträgen, mit Namen "'generation parameters"', "'presentation parameters"' und "'read-only scene information"'.

Während die ersten Beiden Gruppen Felder die vom Benutzer oder der Benutzerin manipuliert werden können enthalten, enthält die letzte Gruppe die nicht vom Benutzer oder der Benutzerin nicht direkt manipulierbaren Einträge "'number of triangles"' und "'number of vertices"'. Unter "'number of triangles"' ist die Anzahl der Dreiecke und unter "'number of vertices"' anderen die Anzahl der Eckpunkte aufgeführt, aus denen sich der aktuell auf dem Bildschirm angezeigt Baum zusammensetzt.

In der Gruppe "'presentation parameters"' findet der Benutzer oder die Benutzerin den Schalter "'autoRotation"' mit dem sich festlegen lässt, ob der Baum automatisch entlang seiner Y-Achse gedreht werden soll, sowie das Eingabefeld "'autoRotationSpeed"' über welches die bei automatischer Rotation anzuwendende Rotationsgeschwindigkeit festgelegt werden kann.
Über den Eintrag "'rotation"' kann durch klicken und ziehen der bunt eingefärbten Kugel die Orientierung des Baumes im Raum verändert werde.

In der Gruppe "'generation parameters"' sind Einträge aufgeführt über die sich der Prozess der Geometriegenerierung des Baumes konfigurieren lässt.
Den ersten Eintrag bildet ein Button mit Aufschrift "'click here to generate tree"'. Ein Klick auf diesen löst die Ausführung des in Kapitel \ref{capter_geometrie} beschriebenen Geometrieerzeugungsalgorithmus aus, welchem als Parameter die Werte der übrigen Eingabefelder, die in der Gruppe "'generation parameters"' enthalten sind, übergeben werde. Wurde die Geometrie erfolgreich erzeugt, so wird der diese nun anstelle der zuvor angezeigten angezeigt.

Der Parameter "'numberOfIterations"' gibt an, wie viele Iterationen des Geometrieerzeugungsalgorithmus verwendet werden sollen.

Die übrigen Parameter sind bereits aus \ref{capter_geometrie} bekannt, ihr Bedeutung soll hier dennoch kurz geklärt werden.

Der Parameter "'scaleLength"' bestimmt, wie lang ein Astsegment im Verhältnis zu seinem Vorgänger ist.

Der Parameter "'scaleTriangle"' bestimmt, wie dick das obere Ende eines Astsegmentes im Verhältnis zu seinem Unteren Ende ist.

Der Parameter "'pyramidFactor"' bestimmt, wie hoch die Pyramide am Ende eines Astsegmentes im Verhältnis zu dessen Länge ist.

%Die äußere Gestaltung der Ausarbeitung hinsichtlich %Abschnittformate, Abbildungen, mathematische Formeln %usw. wird in \hyperref[Stile]{Kapitel~\ref*{Stile}} %kurz dargestellt.

\section{Verwendet Libraries}
Das Programm nutzt mehrere plattformunabhänge Open Source Libraries.
\paragraph{GLEW}
\url{http://glew.sourceforge.net/}
Sorgt dafür, dass man als Programmierer gleich die OpenGL Funktionen aufrufen kann, ohne sich selbst darum kümmern zu müssen irgendwie an die functionpointer zu diesen Funktionen zu kommen.

\paragraph{GLFW}
\url{http://www.glfw.org/}
Vergleichbar mit SDL oder FreeGLUT. Erstellt Fenster und den OpenGL Kontext. Bietet Methoden zur Eingabebehandlung von Mouse und Tastatur.

\paragraph{GLM}
\url{http://glm.g-truc.net/0.9.6/index.html}
Eine Header-Only Library die sich um Mathematik kümmert. Sie stellt unter anderem eine Klasse für Quaternionen zur verfügung und Methoden um View- und Projection-Matrizen zu erzeugen.

\paragraph{AntTweakBar}
\url{http://anttweakbar.sourceforge.net/doc/}
Erlaubt es schnell und einfach einfache Bedienelemente in die eigene OpenGL Anwendung zu integrieren. Sie bietet wie auf dem Folgenden Link zu sehen ist Methoden um sie ganz leicht mit GLFW2, SDL, usw. zu verbinden. \url{http://anttweakbar.sourceforge.net/doc/tools:anttweakbar:howto#5._handle_mouse_and_keyboard_events_and_window_size_changes}
GLFW3, welches ich hier nutze, bringt allerdings API-Änderungen und AntTweakBar unterstützt GLFW3 nicht. \url{http://sourceforge.net/p/anttweakbar/tickets/11/}. Deshalb habe ich in \code{tweakbarutil.cpp} ein paar Methoden geschrieben, welche dieses Problem für mich teilweise lösen.

\section{Aufbau des Programmes}

\subsection{OpenGL Errorbehandlung}
Wenn man sich als Programmierer oder Programmiererin nicht darum kümmert wird einem ein OpenGL Programm nicht mitteilen, warum es gerade abgestürzt ist. OpenGL bietet allerdings einige Funktionen, mit denen man sich relativ hilfreiche Fehlermeldungen ausgeben lassen kann. So sollte man sich nach dem Kompilieren von Shadern und dem Linken von Shaderprogrammen jeweils den Error-Log ausgeben lassen mit \code{glGetProgramiv}, \code{glGetProgramInfoLog}, \code{glGetShaderiv} und \code{glGetShaderInfoLog}. Ich verwende diese in meinem Programm in den Funktionen \code{void Shaderprogram::linkProgram} und \code{void ""Shader""::""create""Shader""From""String}.

Allgemein ist es eine gute Idee, \code{glDebugMessageCallback} zu verwenden, welches einem Erlaubt eine Callbackfunktion anzumelden, die immer aufgerufen wird, wenn ein Fehler auftritt. Ich habe mich an der folgenden Website bedient und den Code für die Funktion großteils übernommen: \url{http://blog.nobel-joergensen.com/2013/02/17/debugging-opengl-part-2-using-gldebugmessagecallback/}.
In meinem Programm Befindet sich die Implementierung dieser Funktion in \code{openglerrorcallback.cpp}.

\section{Der Build Prozess unter Windows 7 mit VisualStudio 2012}
ACHTUNG: Das Programm kompiliert und linkt zwar unter Windows, stürzt beim Ausführen allerdings ab. Damit sie sich vorstellen können wie das Programm aussehen würde wenn sie es ausführen könnten, habe ich ihnen ein Video davon aufgenommen, wie das Programm aussieht, wenn es unter Linux ausgeführt wird. Die Videodatei heißt \code{Video.mp4}.

Der Beschriebene Buildprozess wurde auf den Poolrechnern in Raum L3 getestet.
Entpacken sie \code{Projekt\_Windows.rar}. Navigieren sie zu \code{Projekt\_Windows/""Projekt/""Projekt/""project}. Dort finden sie die Ausführbare Datei \code{premake4.exe}, dies ist das Build Tool. Halten sie \code{CTRL + SHIFT} gedrückt, während sie mit der rechten Mousetaste irgendwo in das gerade geöffnete Fenster des Filemanagers klicken. Es öffnet sich ein Kontextmenue. Wählen sie \code{Eingabeaufforderung hier öffnen} aus. In der nun offenen CMD geben sie den Befehl \code{premake4.exe vs2012} ein, welcher ein *.sln-File für Visual Studio 2012 generiert. Doppelklicken sie auf \code{ProcedualTreeGeneration.sln}. Sollte VS 2012 nun gestartet sein, im Projektmappen-Explorer jedoch nur ein \code{MyFirstTree (Laden fehlgeschlagen)} stehen, rechtsklicken sie darauf, und wählen \code{Projekt erneut laden} aus. Nun können sie durch einen Klick auf \code{Lokaler Windows-Debugger} das Programm kompilieren und linken. Normalerweise sollte das es ohne Fehler (mit ein paar Warnungen) kompilieren und linken. Es wird anschließen versuchen zu starten und kurz danach abstürzen.

Es wird in Zeile 94 der Datei \code{buffer.cpp} beim Ausführen des Befehls \code{gl""Buffer""Sub""Data""(...)} abstürzen. Ich konnte den Fehler leider nicht beheben.

\section{Der Build Prozess unter Linux}
Auf meinem System, einem Arch Linux, kompiliert, linkt und läuft das Programm fehlerfrei. Um das es unter Linux zu kompilieren müssen sie zunächst folgende Abhängigkeiten auflösen indem sie die entsprechenden Pakete ihrer Distribution installieren oder von Hand die benötigten Bibliotheken installieren.

Wie sie \code{AntTweakBar} installieren ist hier beschrieben: \url{http://anttweakbar.sourceforge.net/doc/tools:anttweakbar:download}. Alternativ gibt es für einige Distributionen Packete. ArchLinux: \url{https://aur.archlinux.org/packages/anttweakbar/}, Fedora: \url{https://apps.fedoraproject.org/packages/AntTweakBar}, Gentoo: \code{http://gpo.zugaina.org/media-libs/anttweakbar}.

Sind alle Abhängigkeiten aufgelöst, so kompilieren sie folgendermaßen. Entpacken sie code{Projekt\_Linux.rar}. Navigieren sie mit der Bash nach \code{Projkt\_Linux/""Projekt/""project}. In diesem Ordner liegt bereits die Ausführbare Datei des Buildtools Premake. Generieren sie die GNU-Makefiles mit dem Befehl \code{./premake4 gmake}. Anschließend sollte im Ordner die Datei \code{Makefile} enthalten sein. Die Debug-Version kompilieren sie nun mit \code{make config=debug} und die Release-Version mit \code{make config=release}. Die Ausführbaren Programme liegen nun, falls der Kompilier- und Linkvorgang erfolgreich waren, in \code{./bin/debug} bzw. \code{./bin/release}. Ausführen können sie diese meist mit Doppelklick oder über die Bash.